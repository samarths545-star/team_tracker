<!DOCTYPE html>
<html>
<head>
<title>Performance Analytics</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container mt-4">

<h2>Welcome {{ user }}</h2>

<form method="GET" class="row mb-4">
<div class="col"><input type="date" name="start_date" class="form-control"></div>
<div class="col"><input type="date" name="end_date" class="form-control"></div>
<div class="col"><button class="btn btn-dark">Filter</button></div>
</form>

<hr>

<h4>Upload Consolidated</h4>
<form method="POST" action="/upload_consolidated" enctype="multipart/form-data">
<input type="file" name="file" class="form-control mb-2" required>
<button class="btn btn-primary">Upload</button>
</form>

<hr>

<h4>Upload Data</h4>

{% for action,label,color in [
('/upload_call','Call CSV','success'),
('/upload_fax','Fax CSV','warning'),
('/upload_summons','Summons Excel','danger')
] %}

<form method="POST" action="{{action}}" enctype="multipart/form-data" class="mb-3">
<select name="employee" class="form-select mb-2">
{% for e in employees %}
<option value="{{e}}">{{e}}</option>
{% endfor %}
</select>
<input type="file" name="file" class="form-control mb-2" required>
<button class="btn btn-{{color}}">Upload {{label}}</button>
</form>

{% endfor %}

<hr>

<h3>Performance Analytics</h3>

{% if data %}

<table class="table table-bordered text-center">
<tr class="table-dark">
<th>Rank</th>
<th>Employee</th>
<th>Total Calls</th>
<th>Call Minutes</th>
<th>Total Faxes</th>
<th>Fax Minutes</th>
<th>Records Received</th>
<th>Summons eFiled</th>
<th>Summons Served</th>
<th>Score</th>
</tr>

{% for row in data %}
<tr>
<td>{{row.Rank}}</td>
<td>{{row.employee}}</td>
<td>{{row.total_calls}}</td>
<td>{{row.call_minutes|round(1)}}</td>
<td>{{row.total_faxes}}</td>
<td>{{row.fax_minutes}}</td>
<td>{{row.records_received}}</td>
<td>{{row.summons_efile}}</td>
<td>{{row.summons_served}}</td>
<td><strong>{{row.score|round(2)}}</strong></td>
</tr>
{% endfor %}
</table>

<canvas id="barChart"></canvas>
<canvas id="pieChart" class="mt-5"></canvas>

<script>
const labels = [{% for row in data %}"{{row.employee}}",{% endfor %}];
const scores = [{% for row in data %}{{row.score}},{% endfor %}];

new Chart(document.getElementById("barChart"),{
type:"bar",
data:{labels:labels,datasets:[{label:"Performance Score",data:scores}]}
});

new Chart(document.getElementById("pieChart"),{
type:"pie",
data:{labels:labels,datasets:[{data:scores}]}
});
</script>

{% endif %}

<a href="/logout" class="btn btn-secondary mt-4">Logout</a>

</div>
</body>
</html>
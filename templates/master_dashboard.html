<!DOCTYPE html>
<html>
<head>
<title>Performance Analytics</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background-color: #f8f9fa; }
.card-metric {
    border-radius: 12px;
    padding: 15px;
    color: white;
}
</style>
</head>
<body>

<div class="container mt-4">

<h2 class="mb-3">Welcome {{ user }}</h2>

<!-- ================= FILTER ================= -->

<form method="GET" class="row mb-4">
<div class="col"><input type="date" name="start_date" class="form-control"></div>
<div class="col"><input type="date" name="end_date" class="form-control"></div>
<div class="col"><button class="btn btn-dark">Filter</button></div>
</form>

<hr>

<!-- ================= CONSOLIDATED UPLOAD ================= -->

<h4>Upload Consolidated Excel</h4>
<form method="POST" action="/upload_consolidated" enctype="multipart/form-data">
<input type="file" name="file" class="form-control mb-2" required>
<button class="btn btn-primary">Upload</button>
</form>

<hr>

<!-- ================= OTHER UPLOADS ================= -->

<h4>Upload Data</h4>

{% for action,label,color in [
('/upload_call','Call CSV','success'),
('/upload_fax','Fax CSV','warning'),
('/upload_summons','Summons Excel','danger')
] %}

<form method="POST" action="{{action}}" enctype="multipart/form-data" class="mb-3">
<select name="employee" class="form-select mb-2">
{% for e in employees %}
<option value="{{e}}">{{e}}</option>
{% endfor %}
</select>
<input type="file" name="file" class="form-control mb-2" required>
<button class="btn btn-{{color}}">Upload {{label}}</button>
</form>

{% endfor %}

<hr>

<h3 class="mt-4">Performance Analytics</h3>

{% if data %}

<!-- ================= TABLE ================= -->

<table class="table table-bordered text-center align-middle">
<tr class="table-dark">
<th>Rank</th>
<th>Employee</th>
<th>Total Calls</th>
<th>Call Minutes</th>
<th>Total Faxes</th>
<th>Fax Minutes</th>
<th>Records Received</th>
<th>Expected Records</th>
<th>Summons eFiled</th>
<th>Summons Served</th>
<th>Communication</th>
<th>Records</th>
<th>Legal</th>
<th>Operational</th>
<th>Final Score</th>
<th>Grade</th>
</tr>

{% for row in data %}
<tr>
<td><strong>{{row.Rank}}</strong></td>
<td><strong>{{row.employee}}</strong></td>
<td>{{row.total_calls}}</td>
<td>{{row.call_minutes|round(1)}}</td>
<td>{{row.total_faxes}}</td>
<td>{{row.fax_minutes}}</td>
<td>{{row.records_received}}</td>
<td>{{row.expected_records}}</td>
<td>{{row.summons_efile}}</td>
<td>{{row.summons_served}}</td>
<td>{{row.communication_score|round(1)}}</td>
<td>{{row.records_score|round(1)}}</td>
<td>{{row.legal_score|round(1)}}</td>
<td>{{row.operational_score|round(1)}}</td>
<td><strong>{{row.final_score|round(2)}}</strong></td>
<td>
{% if row.Grade == "A+" %}
<span class="badge bg-success">{{row.Grade}}</span>
{% elif row.Grade == "A" %}
<span class="badge bg-primary">{{row.Grade}}</span>
{% elif row.Grade == "B" %}
<span class="badge bg-warning text-dark">{{row.Grade}}</span>
{% elif row.Grade == "C" %}
<span class="badge bg-secondary">{{row.Grade}}</span>
{% else %}
<span class="badge bg-danger">{{row.Grade}}</span>
{% endif %}
</td>
</tr>
{% endfor %}
</table>

<hr>

<!-- ================= CHARTS ================= -->

<h4 class="mt-4">Performance Overview</h4>

<canvas id="barChart"></canvas>
<canvas id="pieChart" class="mt-5"></canvas>

<script>
const labels = [{% for row in data %}"{{row.employee}}",{% endfor %}];
const scores = [{% for row in data %}{{row.final_score}},{% endfor %}];
const communication = [{% for row in data %}{{row.communication_score}},{% endfor %}];
const records = [{% for row in data %}{{row.records_score}},{% endfor %}];
const legal = [{% for row in data %}{{row.legal_score}},{% endfor %}];
const operational = [{% for row in data %}{{row.operational_score}},{% endfor %}];

// Bar Chart
new Chart(document.getElementById("barChart"),{
type:"bar",
data:{
labels:labels,
datasets:[
{label:"Final Score",data:scores},
{label:"Communication",data:communication},
{label:"Records",data:records},
{label:"Legal",data:legal},
{label:"Operational",data:operational}
]
},
options:{
responsive:true,
plugins:{legend:{position:"top"}},
scales:{y:{beginAtZero:true,max:100}}
}
});

// Pie Chart
new Chart(document.getElementById("pieChart"),{
type:"pie",
data:{labels:labels,datasets:[{data:scores}]}
});
</script>

{% endif %}

<a href="/logout" class="btn btn-secondary mt-4">Logout</a>

</div>
</body>
</html>